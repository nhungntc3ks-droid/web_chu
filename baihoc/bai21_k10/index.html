<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i Python: V√≤ng L·∫∑p While</title>
    <style>
        body { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .game-container { height: 100vh; width: 100%; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 20px; color: white; }
        .game-title { font-size: 32px; font-weight: bold; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .login-screen { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; max-width: 400px; width: 100%; margin-top: 50px; }
        .login-screen h2 { color: #1e3c72; margin-bottom: 20px; }
        #gameBoardWrapper { display: none; width: 100%; flex-direction: column; align-items: center; }
        .student-input { padding: 12px; border-radius: 5px; border: 1px solid #ddd; width: 90%; margin-bottom: 15px; outline: none; font-size: 16px; }
        .game-board { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 750px; width: 100%; margin-bottom: 50px; }
        .level-info { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 18px; font-weight: bold; color: #1e3c72; }
        .challenge-box { background: #f0f4f8; border-left: 5px solid #1e3c72; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .code-area { background: #2d2d2d; border-radius: 10px; padding: 20px; margin-bottom: 20px; font-family: 'Courier New', monospace; color: #f8f8f2; font-size: 16px; line-height: 1.6; }
        .keyword { color: #ff79c6; } .variable { color: #8be9fd; } .number { color: #bd93f9; }
        .loop-input { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: 'Courier New', monospace; margin-bottom: 20px; text-align: center; }
        .btn { width: 100%; padding: 15px; font-size: 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.3s; margin-bottom: 10px; }
        .btn-primary { background: #1e3c72; } .btn-primary:hover { background: #162e58; }
        .btn-start { background: #28a745; } .btn-start:hover { background: #218838; }
        .result-area { background: #fafafa; border-radius: 10px; padding: 15px; min-height: 80px; border: 1px dashed #ccc; }
        .success-message { color: green; font-weight: bold; margin-top: 10px; }
        .error-message { color: red; font-weight: bold; }
        .hint-box { margin-top: 10px; padding: 10px; background: #fff3cd; color: #856404; border-radius: 5px; font-size: 14px; display: none; }
    </style>
</head>
<body>

<main class="game-container">
    <header class="header">
        <h1 class="game-title">üêç Chinh Ph·ª•c While Loop</h1>
        <p>V∆∞·ª£t qua 10 th·ª≠ th√°ch ƒë·ªÉ nh·∫≠n ch·ª©ng ch·ªâ Python!</p>
    </header>

    <div id="loginScreen" class="login-screen">
        <h2>Th√¥ng Tin H·ªçc Sinh</h2>
        <input type="text" id="hsName" class="student-input" placeholder="Nh·∫≠p H·ªç v√† T√™n...">
        <input type="text" id="hsClass" class="student-input" placeholder="Nh·∫≠p L·ªõp (V√≠ d·ª•: 10C1)...">
        <button class="btn btn-start" onclick="startGame()">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
        <p id="loginError" style="color: red; font-size: 13px; display: none;">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n v√† l·ªõp!</p>
    </div>

    <div id="gameBoardWrapper">
        <div class="game-board">
            <div class="level-info">
                <span>B√†i: <span id="currentLevel">1</span>/10</span> 
                <span>ƒêi·ªÉm: <span id="score">0</span>/100</span>
            </div>
            
            <div class="challenge-box">
                <div id="challengeTitle" style="font-weight:bold; margin-bottom:5px;"></div>
                <div id="challengeDesc"></div>
            </div>

            <div class="code-area" id="codeDisplay"></div>
            
            <input type="text" id="loopInput" class="loop-input" placeholder="ƒêi·ªÅn v√†o d·∫•u ???">

            <button class="btn btn-primary" id="runBtn">üöÄ Ki·ªÉm tra Code</button> 
            
            <div class="result-area" id="resultArea">
                <div id="outputDisplay"></div>
            </div>
            <div class="hint-box" id="hintBox"></div>
        </div>
    </div>
</main>

<script>
    // C·∫§U H√åNH ƒê·ªíNG B·ªò V·ªöI APPS SCRIPT
    const LINK_GOOGLE_SHEET = "https://script.google.com/macros/s/AKfycbxAQYTz6tIiDc7st3YzWL7l2m4lTV9tWbKZ1GGbG3lc-cW1GW0DALfUVcXKmFHbrbDp/exec"; 
    const MA_BAI_HOC = "Bai21_while";

    const challenges = [
        { title: "B√†i 1", description: "D√πng 'while' ƒë·ªÉ b·∫Øt ƒë·∫ßu v√≤ng l·∫∑p.", code: `i = 0\n??? i < 3:\n    print(i)\n    i += 1`, answer: "while", hint: "T·ª´ kh√≥a v√≤ng l·∫∑p ch√∫ng ta ƒëang h·ªçc l√† g√¨?", output: "0, 1, 2" },
        { title: "B√†i 2", description: "In c√°c s·ªë t·ª´ 1 ƒë·∫øn 5.", code: `n = 1\nwhile n <= ???:\n    print(n)\n    n += 1`, answer: "5", hint: "S·ªë cu·ªëi c√πng c·∫ßn in ra l√† 5.", output: "1, 2, 3, 4, 5" },
        { title: "B√†i 3", description: "V√≤ng l·∫∑p ch·∫°y khi x kh√°c 0.", code: `x = 3\nwhile x ??? 0:\n    print(x)\n    x -= 1`, answer: "!=", hint: "To√°n t·ª≠ 'kh√°c' trong Python l√† g√¨?", output: "3, 2, 1" },
        { title: "B√†i 4", description: "In c√°c s·ªë ch·∫µn: 2, 4, 6.", code: `n = 2\nwhile n <= 6:\n    print(n)\n    n = n + ???`, answer: "2", hint: "S·ªë ch·∫µn c√°ch nhau m·∫•y ƒë∆°n v·ªã?", output: "2, 4, 6" },
        { title: "B√†i 5", description: "D√πng True ƒë·ªÉ t·∫°o v√≤ng l·∫∑p v√¥ h·∫°n.", code: `while ???:\n    print("Hi")\n    break`, answer: "True", hint: "Gi√° tr·ªã ƒë√∫ng (vi·∫øt hoa ch·ªØ ƒë·∫ßu) trong Python.", output: "Hi" },
        { title: "B√†i 6", description: "T√≠nh t·ªïng S = 1 + 2. TƒÉng i l√™n 1.", code: `S = 0; i = 1\nwhile i <= 2:\n    S += i\n    i ??? 1\nprint(S)`, answer: "+=", hint: "C·∫ßn tƒÉng i th√™m 1 sau m·ªói l·∫ßn l·∫∑p.", output: "3" },
        { title: "B√†i 7", description: "In c√°c s·ªë gi·∫£m d·∫ßn: 10, 5.", code: `k = 10\nwhile k >= 5:\n    print(k)\n    k -= ???`, answer: "5", hint: "10 v·ªÅ 5 th√¨ b·ªõt ƒëi bao nhi√™u?", output: "10, 5" },
        { title: "B√†i 8", description: "Tho√°t v√≤ng l·∫∑p ngay l·∫≠p t·ª©c.", code: `while True:\n    ???\n    print("Kh√¥ng in d√≤ng n√†y")`, answer: "break", hint: "L·ªánh b·∫ª g√£y v√≤ng l·∫∑p.", output: "" },
        { title: "B√†i 9", description: "Ch·ªâ in s·ªë 0.", code: `i = 0\nwhile i < ???:\n    print(i)\n    i += 1`, answer: "1", hint: "ƒê·ªÉ ch·ªâ in 0, i ph·∫£i b√© h∆°n 1.", output: "0" },
        { title: "B√†i 10", description: "C·ªông d·ªìn v√†o bi·∫øn S.", code: `S = 0; n = 5\nwhile n > 0:\n    S = ??? + n\n    n -= 5\nprint(S)`, answer: "S", hint: "T·ªïng m·ªõi = T·ªïng c≈© + n.", output: "5" }
    ];

    let currentLevel = 0;
    let score = 0;
    let attempts = 0;

    function startGame() {
        const ten = document.getElementById("hsName").value.trim();
        const lop = document.getElementById("hsClass").value.trim();
        if (ten === "" || lop === "") {
            document.getElementById("loginError").style.display = "block";
            return;
        }
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("gameBoardWrapper").style.display = "flex";
        updateUI();
    }

    function updateUI() {
        const c = challenges[currentLevel];
        document.getElementById('currentLevel').textContent = currentLevel + 1;
        document.getElementById('score').textContent = score;
        document.getElementById('challengeTitle').textContent = c.title;
        document.getElementById('challengeDesc').textContent = c.description;
        document.getElementById('codeDisplay').innerHTML = c.code
            .replace(/while|break/g, m => `<span class="keyword">${m}</span>`)
            .replace(/True/g, `<span class="number">True</span>`)
            .replace(/\?\?\?/g, `<span style="color:red; font-weight:bold">???</span>`)
            .replace(/\n/g, '<br>');
        document.getElementById('loopInput').value = '';
        document.getElementById('outputDisplay').innerHTML = '';
        document.getElementById('hintBox').style.display = 'none';
        attempts = 0;
    }

    function guiDiem() {
        const ten = document.getElementById("hsName").value;
        const lop = document.getElementById("hsClass").value;
        const out = document.getElementById('outputDisplay');

        out.innerHTML = `<div style="color: blue; font-weight: bold;">‚è≥ ƒêang g·ª≠i k·∫øt qu·∫£ v·ªÅ h·ªá th·ªëng...</div>`;

        // G·ª≠i d·ªØ li·ªáu kh·ªõp v·ªõi bi·∫øn c·ªßa Apps Script b√†i Thi·∫øt b·ªã th√¥ng minh
        fetch(LINK_GOOGLE_SHEET, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({
                ten_hoc_sinh: ten,
                lop: lop,
                ma_bai: MA_BAI_HOC,
                diem_so: score // G·ª≠i s·ªë nguy√™n ƒë·ªÉ Apps Script t·ª± x·∫øp lo·∫°i
            })
        }).then(() => {
            alert(`Ch√∫c m·ª´ng ${ten} - L·ªõp ${lop}!\nƒêi·ªÉm c·ªßa em l√†: ${score}/100\nK·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông.`);
            out.innerHTML = `<div class="success-message">üèÜ ƒê√É HO√ÄN TH√ÄNH V√Ä G·ª¨I ƒêI·ªÇM!</div>`;
            document.getElementById('runBtn').disabled = true;
        }).catch(err => {
            console.error("L·ªói g·ª≠i ƒëi·ªÉm:", err);
            alert("C√≥ l·ªói khi g·ª≠i ƒëi·ªÉm, nh∆∞ng em ƒë√£ ho√†n th√†nh b√†i thi!");
        });
    }

    document.getElementById('runBtn').addEventListener('click', function() {
        const input = document.getElementById('loopInput').value.trim();
        const c = challenges[currentLevel];
        const out = document.getElementById('outputDisplay');

        if(input === c.answer) {
            score += 10; // M·ªói c√¢u ƒë√∫ng c·ªông 10 ƒëi·ªÉm
            out.innerHTML = `<div class="success-message">‚úîÔ∏è Ch√≠nh x√°c! (K·∫øt qu·∫£: ${c.output})</div>`;
            setTimeout(() => {
                currentLevel++;
                if(currentLevel < challenges.length) {
                    updateUI();
                } else {
                    guiDiem(); 
                }
            }, 1200);
        } else {
            attempts++;
            if(attempts < 2) {
                out.innerHTML = `<div class="error-message">‚ùå Sai r·ªìi! Em c√≤n 1 l·∫ßn th·ª≠ l·∫°i.</div>`;
                document.getElementById('hintBox').style.display = 'block';
                document.getElementById('hintBox').textContent = "üí° G·ª£i √Ω: " + c.hint;
            } else {
                out.innerHTML = `<div class="error-message">‚ùå V·∫´n ch∆∞a ƒë√∫ng. Qua c√¢u ti·∫øp theo nh√©.</div>`;
                setTimeout(() => {
                    currentLevel++;
                    if(currentLevel < challenges.length) {
                        updateUI();
                    } else {
                        guiDiem(); 
                    }
                }, 1200);
            }
        }
    });

    document.getElementById('loopInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            document.getElementById('runBtn').click();
        }
    });
</script>
</body>
</html>